services:
  # The Node.js Application Service
  app:
    build: .
    restart: always
    container_name: tunecraft_app
    environment:
      - PORT=3000 # Ensure server.js listens on this port
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      - DOMAIN=${DOMAIN}
      - MONGODB_URI=${MONGODB_URI}
    networks:
      - tunecraft_net

  # The Caddy Web Server Service
  caddy:
    image: caddy:alpine
    restart: always
    container_name: tunecraft_caddy
    ports:
      - "80:80"   # HTTP
      - "443:443" # HTTPS (if you configure a domain later)
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile # Mount the config
      - caddy_data:/data # Persist SSL certificates
      - caddy_config:/config
    depends_on:
      - app
    networks:
      - tunecraft_net

networks:
  tunecraft_net:

volumes:
  caddy_data:
  caddy_config: